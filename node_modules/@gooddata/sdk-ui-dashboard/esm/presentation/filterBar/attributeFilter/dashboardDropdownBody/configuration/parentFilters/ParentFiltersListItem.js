// (C) 2022 GoodData Corporation
import React, { useCallback, useMemo } from "react";
import cx from "classnames";
import { FormattedMessage } from "react-intl";
import { ParentFiltersDisabledItem } from "./ParentFiltersDisabledItem";
import { stringUtils } from "@gooddata/util";
import { useDashboardSelector, selectIsCircularDependency, } from "../../../../../../model";
import { ConnectingAttributeDropdown } from "../connectingAttribute/ConnectingAttributeDropdown";
export var ParentFiltersListItem = function (props) {
    var _a = props.item, isSelected = _a.isSelected, localIdentifier = _a.localIdentifier, selectedConnectingAttribute = _a.selectedConnectingAttribute, onClick = props.onClick, currentFilterLocalId = props.currentFilterLocalId, connectingAttributes = props.connectingAttributes, onConnectingAttributeSelect = props.onConnectingAttributeSelect, title = props.title;
    var isCircularDependency = useDashboardSelector(selectIsCircularDependency(currentFilterLocalId, localIdentifier));
    var isDisabled = isCircularDependency || !connectingAttributes.length;
    var showConnectingAttributeSelect = isSelected && connectingAttributes.length > 1;
    var activeItemClasses = useMemo(function () {
        return cx("gd-list-item attribute-filter-item s-attribute-filter-dropdown-configuration-item", "s-" + stringUtils.simplifyText(title), {
            "is-selected": isSelected,
        });
    }, [isSelected, title]);
    var onSelect = useCallback(function () {
        var connectingAttributeRefs = connectingAttributes.map(function (attr) { return attr.ref; });
        onClick(localIdentifier, !isSelected, connectingAttributeRefs);
    }, [isSelected, localIdentifier, onClick, connectingAttributes]);
    if (isDisabled) {
        return (React.createElement(ParentFiltersDisabledItem, { hasConnectingAttributes: !!connectingAttributes.length, itemTitle: title, itemLocalId: currentFilterLocalId }));
    }
    return (React.createElement(React.Fragment, null,
        React.createElement("div", { className: activeItemClasses, onClick: onSelect, title: title },
            React.createElement("label", { className: "input-checkbox-label configuration-item-title" },
                React.createElement("input", { type: "checkbox", className: "input-checkbox s-checkbox", checked: isSelected, readOnly: true }),
                React.createElement("span", { className: "input-label-text" }, title),
                showConnectingAttributeSelect && (React.createElement("span", { className: "addon" },
                    "\u00A0",
                    React.createElement(FormattedMessage, { id: "attributesDropdown.attributeNameWithData" }))))),
        showConnectingAttributeSelect && (React.createElement(ConnectingAttributeDropdown, { itemLocalId: localIdentifier, connectingAttributes: connectingAttributes, selectedConnectingAttributeRef: selectedConnectingAttribute || connectingAttributes[0].ref, onSelect: onConnectingAttributeSelect }))));
};
//# sourceMappingURL=ParentFiltersListItem.js.map